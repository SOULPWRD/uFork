# Actor Wire Protocol

The Actor Wire Protocol (AWP) facilitates the secure, unordered delivery of
messages between actors over the network. Messages can contain actor addresses,
allowing actors to perform introductions. Messages can be sent reliably or
unreliably.

The protocol assumes a __transport__ providing secure, unreliable, and unordered
delivery of small binary blobs between parties located on different machines.

When an actor wishes to communicate with actors outside of its own address
space, it does so via a __party__. Every party has a secure __name__ that it
can prove it owns, and may have a network __address__ to help other parties
find it.

When a party receives a message from a remote party, it attempts to forward it
to a local actor. Messages tagged with a __swiss number__ are forwarded to the
designated actor, all other messages are forwarded to the party's
__greeter__ actor, if one is registered.

## Transports

The transport is responsible for authenticating remote parties and encrypting
frame traffic. Note that network addresses are used solely for routing, and
should not be relied upon for security.

Existing transport protocols that are suitable include DTLS and QUIC. Ordered
protocols such as TLS will also work, but may incur a performance penalty due
to head-of-line blocking.

## Frames

Each binary blob sent or received by a transport is a __frame__. A frame is an
[OED-encoded object](https://github.com/organix/mycelia/blob/master/OED.md).

Message frames have the following properties:

- `id`: the frame's unique identifier, a non-negative integer.
- `to`: the destination actor's swiss number. If omitted, the message is
  delivered to the greeter.
- `message`: the OED-encoded message. See "Marshalling" below.
- `acknowledge`: true if the frame should be acknowledged. Defaults to false.

Acknowledgement frames have a single property:

- `ack_id`: the identifier of the frame being acknowledged.

## Marshalling

Outgoing messages must be encoded as OED prior to transmission, then decoded at
the other end. This process is referred to as __marshalling__
and __unmarshalling__.

Implementations are free to marshall messages however they see fit, with one
exception. Any actor address found in the message must be encoded as an OED
Extension BLOB like

Field   | Contents
--------|----------------------
meta    | `{name}` or `{name, address}`
data    | 128-bit Swiss number

The _meta_ field is an object containing actor's party's name and optionally its
address. The format of the name and address are transport-dependent.

The _data_ field is the actor's unguessable Swiss number, as a sequence of 16
octets. Swiss numbers should be generated by a secure random number generator,
and retained for the lifetime of the actor.
